<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Kitties Demo</title>
  <style>
    .stage { width: 600px; height: 400px; background-color: #969696; }
    .layer { position: absolute; }
  </style>
</head>
<body>
  <div class="stage">
    <canvas data-canvas-background class="layer" width="600" height="400"></canvas>
    <canvas data-canvas-entities class="layer" width="600" height="400"></canvas>
    <canvas data-canvas-colliders class="layer" width="600" height="400"></canvas>
  </div>
  <script src="dist/kitties.js"></script>
  <script>
    /* NOTES:
     *  This framework is RDV (Resource-Data-View) ??
     * 
     */

    var resource;
    var refresh;

    use([
      'Util',
      'HttpResource',
      'ImageResource',
      'Resource',
      'ResourceRegistry',
      'Sprites',
      'EntityLayer',
      'BackgroundLayer',
      'CollisionLayer',
      'Scheduler', 
      'Common',
      'canvas-background',
      'canvas-entities',
      'canvas-colliders'
      ],
    function(
      Util,
      HttpResource,
      ImageResource,
      Resource,
      ResourceRegistry,
      Sprites,
      EntityLayer, 
      BackgroundLayer, 
      CollisionLayer, 
      Scheduler, 
      Common, 
      canvasBackground, 
      canvasEntities, 
      canvasColliders
      ) {
      'use strict';

      var viewport = {
        x: 0,
        y: 0,
        width: 600,
        height: 400
      };       

      refresh = function() {
        return ResourceRegistry.getResources('assets/kitty.json');
      };

      // VIEW STUFF

      // Setup background layer
      var backgroundLayer = BackgroundLayer(canvasBackground);
      Scheduler(function () {
        backgroundLayer.draw(viewport);
      });

      // Setup entity layer
      var entityLayer = EntityLayer(canvasEntities);
      Scheduler(function () {
        entityLayer.draw(viewport);
      });

      // Setup collision debug layer
      var collisionLayer = CollisionLayer(canvasColliders);
      Scheduler(function () {
        collisionLayer.draw(viewport);
      });


      // DATA STUFF
      var sceneUri = 'kitty-world.json';
      Resource.baseUri = 'assets';

      HttpResource(sceneUri).ready(function(sceneData) {
        var layerDefinitions = sceneData.layerDefinitions;

        ImageResource(layerDefinitions.background.backgroundUrl)
          .ready(function (background) {
            backgroundLayer.setBackground(background);
          });

        entityLayer.clear();
        resource = Sprites(layerDefinitions.entities.sprites)
          .ready(function (sprite) {
            sprite.animation.play('run');
            entityLayer.addEntity(sprite);
          }, function() { console.log('ERROR!!')});

        collisionLayer.setColliders(layerDefinitions.collisions.colliders);
      });
    });
  </script>
</body>
</html>