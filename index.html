<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Kitties Demo</title>
  <style>
    .stage { width: 600px; height: 400px; background-color: #969696; }
    .layer { position: absolute; }
  </style>
</head>
<body>
  <div class="stage">
    <canvas data-canvas-background class="layer" width="600" height="400"></canvas>
    <canvas data-canvas-entities class="layer" width="600" height="400"></canvas>
    <canvas data-canvas-colliders class="layer" width="600" height="400"></canvas>
  </div>
  <script src="dist/kitties.js"></script>
  <script>
    /* NOTES:
     *  This framework is RDV (Resource-Data-View) ??
     * 
     */

    var resource;

    use([
      'Util',
      'HttpResource',
      'ImageResource',
      'Resource',
      'Sprites',
      'EntityLayer',
      'BackgroundLayer',
      'CollisionLayer',
      'Scheduler', 
      'Common',
      'canvas-background',
      'canvas-entities',
      'canvas-colliders'
      ],
    function(
      Util,
      HttpResource,
      ImageResource,
      Resource,
      Sprites,
      EntityLayer, 
      BackgroundLayer, 
      CollisionLayer, 
      Scheduler, 
      Common, 
      canvasBackground, 
      canvasEntities, 
      canvasColliders
      ) {
      'use strict';

      var viewport = {
        x: 0,
        y: 0,
        width: 600,
        height: 400
      };       

      // VIEW STUFF

      // Setup background layer
      var backgroundLayer = BackgroundLayer(canvasBackground);
      Scheduler(function () {
        backgroundLayer.draw(viewport);
      });

      // Setup entity layer
      var entityLayer = EntityLayer(canvasEntities);
      Scheduler(function () {
        entityLayer.draw(viewport);
      });

      // Setup collision debug layer
      var collisionLayer = CollisionLayer(canvasColliders);
      Scheduler(function () {
        collisionLayer.draw(viewport);
      });


      // DATA STUFF
      var sceneUri = 'kitty-world.json';
      var baseUri = 'assets'; //Common.getBaseUrl(sceneUri);
      Resource.baseUri = baseUri;

      HttpResource(sceneUri).ready(function(sceneData) {
        ImageResource(sceneData.layerDefinitions.background.backgroundUrl)
          .ready(function (background) {
            backgroundLayer.setBackground(background);
          });

        entityLayer.clear();
        Sprites(sceneData.layerDefinitions.entities.sprites).ready(function (sprite) {
          entityLayer.addEntity(sprite);
        });

        collisionLayer.setColliders(sceneData.layerDefinitions.collisions.colliders);
      });

    });
  </script>
</body>
</html>